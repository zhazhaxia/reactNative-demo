
## 分享课件

### 讲师个人介绍
1 工作经历
2 工作内容
3 工作沉淀
4 擅长方向

### 本次课程内容的大纲
1 hooks的出现
2 代数效应
3 hooks相关的数据结构
4 hooks的执行过程
5 实现一个hooks
6 hooks源码的结构

### hooks的出现
1 V16.8正式出现，用于函数组件中
2 类组件和函数组件差异
3 react团队推荐采用函数组件的编写方式写组件
4 hooks之前的函数组件，纯函数，有局限性
5 hooks 丰富函数组件的能力
6 为什么叫hooks？
  即钩子，如果需要外部功能和副作用，就用钩子把外部代码"钩"进来
7 hooks践行了代数效应

### 什么是代数效应
代数效应是一个处在研究阶段的编程语言特性，这意味着其不像 if、functions、async / await 一样，你可能无法在生产环境真正用上它。
代数效应也是一种设计思想，直接英文字面意思理解就是：代数的效果
这样理解可能比较难懂，我们从一些例子来了解下代数效应。

- 想想我们前端语言发展的一些语言特性
1 以前只能用for/while来处理循环，后面有了forEach/map/forOf等
2 以前写异步要一堆回调，现在有了async/await
3 其他

每次新语言特性出现，简化了我们程序的编写，我们都会说出三个字：tql

- try/catch的例子
1 错误异常的多层冒泡
2 一旦一个地方错误，后续代码没有办法继续执行（当然可以通过一些if/else避免，但是麻烦）
3 如何解决

- 代数效应解决try/catch的痛点
1 try/handle
2 perform 'info'
3 resume with

- 未来的探索
1 async/await完美吗？
  污染调用await的函数

2 跟react hooks的关系

简单总结：代数效应是一种可以构建新的语法糖，并简化函数调用方式的持续设计理念
优化程序调用的思想

### 代数效应跟reactHooks有什么关系
1 怎么让纯函数有类似类组件那样的功能？
2 如果没有reactHooks，让一个组件也具有丰富的功能，写起来会很繁琐
3 reactHooks解决繁琐，践行代数效应

### react hooks的源码实现 - 实现一个useState
useState是最常用，也是react内部实现最巧妙的hooks
1 fiber表述了一个组件
2 组件内的hooks采用单向链表构造
3 每次状态的更新采用了循环链表
4 更新后重新渲染组件


### 手写个源码吧





## 开头
各位好，欢迎大家报名本期课程，本期课程主题是深入浅出理解React Hooks原理

ok按照惯例，先介绍下讲师，也就是我本人，miluwu
16年加入全民K歌社区产品部、21年在互动视频产品部歌房组
下面是一些个人在工作期间的一些技术和业务的一些沉淀，这里就不赘述了

## 这门课
其实关于这门，主要的用户群体是新同学，或者是没有接触过react源码的同学，当然，如果有不少已经很熟悉react源码的同学在听的话，也希望这门课可以带给你们新的思考。

不知道你们有没有这些疑惑，写那么多react代码，有没有了解过react源码，是否也对源码感兴趣，如果你也有这些疑惑，那很好，我们继续

## 这门课的内容

先说下课程大纲，这里其实列了5点，但是比较重点的就是代数效应和源码部分，我猜也是大家比较感兴趣的部分，也是我主要讲的部分

我会先讲一些代数效应的概念，最后会现场演示，基于react的设计思想，手写一个hooks-useState

### 为什么是react hooks

说下为什么react在这5,6年的更新中，在最新版本选择了hooks，选择了函数组件

这是一些背景的介绍，我挑 一些比较核心的讲讲

首先我们知道hooks在v16.8版本正式引入，引入后也收到很多开发者的欢迎。
为什么那么欢迎呢？

先从组件说起：
以前有类组件和函数组件，这里演示了同一个组件，不同写法的区别
类组件比较臃肿，函数组件更清晰，但是函数组件也有缺点

那就是：1，2,3，因此没法取代类组件

但是函数组件的优势是如此明显，react团队也推荐用函数组件编写。

为了解决这个函数组件的缺陷，hooks出现了


那么hooks是什么？
hooks就是钩子，在用纯函数写react组件的时候，如果需要外部的代码，只需要用钩子，把代码钩进来执行即可。
比如这个图。。。

#### 刚刚说react团队实现了hooks，那么hooks是怎么设计出来的呢？
在这之前，思考几个问题
怎么让函数组件丰富，没有hooks，很麻烦，reactHooks就是这些难点
在实现hooks的背后，如作者说：我们在践行代数效应，那么什么是代数效应？



### 代数效应

代数效应，这个概念老实说不是很好理解，官方解释说这事一个研究中的语言特性。这个解释其实就很迷惑了。
我之前查了不少文章，发现都没有一些清晰的解释，当然不是说这些文章没用，只是目前来说，代数效应，还是偏概念性的研究。
不过我还是会结合自己的研究，在这堂课，阐述清楚，大家对代数效应的理解。

先看看这两个字面意思，代数、效应

#### 一个初级理解
我们以前有一个一元线性函数，后来数学家发明，二元一次方程，但是这个函数不够，所以后面又有了二次方程，甚至其他更复杂的。

那这跟代数效应有什么关系？

很显然，如果不用二次方程表达曲线，我们的表达式会很麻烦，所以要二次方程就是解决这个麻烦。

好，这里给第一个定义：代数效应是复杂代数式的抽象。

#### 应用在代码里面
刚刚是代数表达式的理解，现在我们用编程来理解

这里写一个try/catch的例子

。。。
getNumber
addNumber

try/catch

痛点是：异常后，一层层抛出，而且，程序不能继续了

#### try/handle解决

这里我们catch用handle替换，handle可以拿到一个effect，效应
根据effect类型，我们执行resume with一个返回，resume 即恢复



try/handle的作用

很可惜，现在这个不存在，也许，以后某个es版本会存在

#### 代数效应的总结
1 代数效应是一个语法糖
2 代数效应是一个新的表达式
3 代数效应可以优化程序调用方式、优化代码组织方式


#### 那么这里跟reactHooks有什么关系

根据刚刚代数效应的定义，如react团队所说的，为了解决上面问题，他们正在践行代数效应



### 下面就进入我们第二大部分了，开始写代码了，实现一个reactHooks
打起精神，开始核心内容了。

在这里我会实现react里面其中一个hooks，也就是 useState

为什么选useState呢？

#### 在这之前，我们先介绍几个写hooks之前的概念
我们根据这几个hooks相关的核心概念，就可以手动实现一个hooks，很简单，90行！！！


首先是fiberNode，fiber是组件行为的描述，一个fiber有很多属性，我这里只截图一部分

然后是hooks的结构，采用单向列表。我们在组件里面会用到好几个hooks，这些hook是通过单向链表连接的

接下来是update节点，更新节点，采用了循环链表的方式构造。更新节点就是我们调用setState产生的节点，我们可能会同时调用多次update，所以这里也是一个链表。

最后是更新数据逻辑，reacthooks会根据update节点链表，获取新的状态值。


### 好的理清楚上面的概念，我们正式开始写一个hooks了，usestate

演示完成
### 那么我们手写一个是这样实现的，具体到源码是怎么做的，我们看看。
首先看看setState

然后分析。。。

讲到memo的优化


最后看看我们优化下我们的hooks，支持异步，赋值


### 总结

希望这节课，对大家理解react有帮助

最后感谢大家报名本次分享


后面有个签到和问卷，麻烦填写哈






